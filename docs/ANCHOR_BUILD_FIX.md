# Fix: __client_accounts_instructions Error

**Error:** `could not find '__client_accounts_instructions' in the crate root`

**Root Cause:** This error occurs when:
1. Anchor's code generation hasn't run (need `anchor build`, not `cargo build`)
2. Stale build artifacts from different Anchor version
3. Permission issues preventing clean build

**Solution:** Use `anchor build` (not `cargo build`) and fix permissions

---

## Quick Fix

### Step 1: Fix Permissions (Run in Terminal)

```bash
cd ~/Documents/Projects/veiled/packages/anchor/programs/veiled

# Fix permissions
sudo chown -R $USER:$USER target/ 2>/dev/null || true
chmod -R u+w target/ 2>/dev/null || true

# Remove target if permissions still fail
sudo rm -rf target/ 2>/dev/null || rm -rf target/ 2>/dev/null || true
```

### Step 2: Use Anchor Build (Not Cargo)

**IMPORTANT:** Anchor needs to generate code via `anchor build`, not `cargo build`:

```bash
cd ~/Documents/Projects/veiled/packages/anchor

# Use anchor build (generates __client_accounts_instructions)
anchor build

# NOT: cargo build (doesn't generate Anchor code)
```

### Step 3: Verify Build

```bash
# Check that IDL was generated
ls -la target/idl/veiled.json

# Check that .so was built
ls -la target/deploy/veiled.so
```

---

## Why This Happens

The `#[program]` macro in Anchor generates helper code including `__client_accounts_instructions`. This code is generated by the Anchor CLI during `anchor build`, not by Rust's compiler.

**What `anchor build` does:**
1. Runs `cargo build-sbf` to compile Rust
2. Generates IDL from your program
3. Generates TypeScript types
4. Generates helper code (like `__client_accounts_instructions`)

**What `cargo build` does:**
- Only compiles Rust
- Doesn't generate Anchor's helper code
- Result: Missing `__client_accounts_instructions` → compilation error

---

## Alternative: If Permissions Can't Be Fixed

If you can't fix permissions, try building in a clean location:

```bash
cd ~/Documents/Projects/veiled/packages/anchor

# Build with anchor (will create new target/)
anchor build

# This should work even if old target/ has permission issues
```

---

## Expected Output

After `anchor build`, you should see:

```
Building...
Compiling veiled v0.1.0
Finished release [optimized] target(s) in X.XXs
```

No `__client_accounts_instructions` error! ✅

---

**The key: Always use `anchor build`, never `cargo build` directly for Anchor programs!**
